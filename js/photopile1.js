var photopile=function(){function g(){$(".js div.photopile-wrapper").css({"background-repeat":"no-repeat","background-position":"50%, 50%","background-image":"url("+m+")"});$("ul.photopile").children().each(function(){b.init($(this))});w.init();$(window).load(function(){$(".js div.photopile-wrapper").css({padding:t+"px","background-image":"none"}).children().css({opacity:"0",display:"inline-block"}).fadeTo(u,1);E.init();if(d){y()}})}function y(){var e=$("ul.photopile").children().first();window.setInterval(function(){e.children().first().click();if(e.hasClass("last")){e=$("ul.photopile").children().first()}else{e=e.next()}},v)}var e=5;var t=50;var n=45;var r=2;var i="white";var s="#EAEAEA";var o=true;var u=200;var a=500;var f=100;var l=10;var c="white";var h=true;var p=1;var d=false;var v=5e3;var m="img/photog/loading.gif";var b={active:"photopile-active-thumbnail",init:function(t){self=this;t.children().css("padding",r+"px");self.bindUIActions(t);self.setRotation(t);self.setOverlap(t);self.setRandomZ(t);if(o){var n=0;var s=0;t.draggable({start:function(n,r){t.addClass("preventClick");t.css("z-index",e+2);$("ul.photopile").children().each(function(){t.unbind("mouseover",self.bringToTop);t.unbind("mouseout",self.moveDownOne)})},drag:function(e,r){s=(r.offset.left-n)*1.2;ratio=parseInt(s*100/360);t.css("transform","rotateZ("+ratio+"deg)");n=r.offset.left},stop:function(n,r){t.css("z-index",e+1);$("ul.photopile").children().each(function(){t.bind("mouseover",self.bringToTop);t.bind("mouseout",self.moveDownOne)})}})}t.css("background",i)},bindUIActions:function(e){var t=this;e.bind("mouseover",t.bringToTop);e.bind("mouseout",t.moveDownOne);e.click(function(e){e.preventDefault();if($(this).hasClass("preventClick")){$(this).removeClass("preventClick")}else{if($(this).hasClass(t.active))return;w.pickup($(this))}});e.mousedown(function(e){$(this).removeClass("preventClick")})},bringToTop:function(){$(this).css({"z-index":e+1,background:s})},moveDownOne:function(){$(this).css({"z-index":e,background:i})},setOverlap:function(e){e.css("margin",t*-1/2+"px")},setZ:function(e,t){e.css("z-index",t)},setRandomZ:function(t){t.css({"z-index":Math.floor(Math.random()*e+1)})},setRotation:function(e){var t=-1*n;var r=n;var i=Math.floor(Math.random()*(r-t+1))+t;e.css({transform:"rotate("+i+"deg)"})},setActive:function(e){e.addClass(this.active)},getActiveOffset:function(){return $("li."+this.active).offset()},getActiveHeight:function(){return $("li."+this.active).height()},getActiveWidth:function(){return $("li."+this.active).width()},getActiveImgSrc:function(){return $("li."+this.active).children().first().attr("href")},getActiveRotation:function(){var e=$("li."+this.active).css("transform");var t=e.split("(")[1].split(")")[0].split(",");var n=Math.round(Math.asin(t[1])*(180/Math.PI));return n},getActive:function(){return $("li."+this.active)[0]?$("li."+this.active).first():false},getActiveShift:function(){return this.getActiveRotation()<0?-(this.getActiveRotation(b)*.4):this.getActiveRotation(b)*.4},clearActiveClass:function(){$("li."+this.active).fadeTo(u,1).removeClass(this.active)}};var w={container:$('<div id="photopile-active-image-container"/>'),image:$('<img id="photopile-active-image" />'),info:$('<div id="photopile-active-image-info"/>'),isPickedUp:false,fullSizeWidth:null,fullSizeHeight:null,windowPadding:40,init:function(){$("body").append(this.container);this.container.css({display:"none",position:"absolute",padding:r,"z-index":"10009",background:c,"background-image":"url("+m+")","background-repeat":"no-repeat","background-position":"50%, 50%"});this.container.append(this.image);this.image.css("display","block");if(h&&p==1){p=0;this.container.append(this.info);this.info.append("<p></p>");this.info.css("opacity","0")}},pickup:function(e){var t=this;if(t.isPickedUp){t.putDown(function(){t.pickup(e)})}else{t.isPickedUp=true;b.clearActiveClass();b.setActive(e);t.loadImage(b.getActiveImgSrc(),function(){t.image.fadeTo(u,"1");t.enlarge();$("body").bind("click",function(){t.putDown()})})}},putDown:function(t){self=this;$("body").unbind();self.hideInfo();E.hideControls();b.setZ(b.getActive(),e);self.container.stop().animate({top:b.getActiveOffset().top+b.getActiveShift(),left:b.getActiveOffset().left+b.getActiveShift(),width:b.getActiveWidth()+"px",height:b.getActiveHeight()+"px",padding:r+"px"},a,function(){self.isPickedUp=false;b.clearActiveClass();self.container.fadeOut(u,function(){if(t)t()})})},loadImage:function(e,t){var n=this;n.image.css("opacity","0");n.startPosition();var r=new Image;r.src=e;r.onload=function(){n.fullSizeWidth=this.width;n.fullSizeHeight=this.height;n.setImageSource(e);if(t)t()}},startPosition:function(){this.container.css({top:b.getActiveOffset().top+b.getActiveShift(),left:b.getActiveOffset().left+b.getActiveShift(),transform:"rotate("+b.getActiveRotation()+"deg)",width:b.getActiveWidth()+"px",height:b.getActiveHeight()+"px",padding:r}).fadeTo(u,"1");b.getActive().fadeTo(u,"0")},enlarge:function(){var e=window.innerHeight?window.innerHeight:$(window).height();var t=$(window).width()-2*this.windowPadding;var n=e-2*this.windowPadding;if(t<this.fullSizeWidth&&n<this.fullSizeHeight){if(t*(this.fullSizeHeight/this.fullSizeWidth)>n){this.enlargeToWindowHeight(n)}else{this.enlargeToWindowWidth(t)}}else if(t<this.fullSizeWidth){this.enlargeToWindowWidth(t)}else if(n<this.fullSizeHeight){this.enlargeToWindowHeight(n)}else{this.enlargeToFullSize()}},showInfo:function(){if(h){this.info.children().text(b.getActive().children("a").children("img").attr("alt"));this.info.css({"margin-top":-this.info.height()+"px"}).fadeTo(u,1)}},hideInfo:function(){if(h){this.info.fadeTo(u,0)}},enlargeToFullSize:function(){self=this;self.container.css("transform","rotate(0deg)").animate({top:$(window).scrollTop()+$(window).height()/2-self.fullSizeHeight/2,left:$(window).scrollLeft()+$(window).width()/2-self.fullSizeWidth/2,width:self.fullSizeWidth-2*l+"px",height:self.fullSizeHeight-2*l+"px",padding:l+"px"},function(){self.showInfo();E.showControls()})},enlargeToWindowWidth:function(e){self=this;var t=e*(self.fullSizeHeight/self.fullSizeWidth);self.container.css("transform","rotate(0deg)").animate({top:$(window).scrollTop()+$(window).height()/2-t/2,left:$(window).scrollLeft()+$(window).width()/2-e/2,width:e+"px",height:t+"px",padding:l+"px"},function(){self.showInfo();E.showControls()})},enlargeToWindowHeight:function(e){self=this;var t=e*(self.fullSizeWidth/self.fullSizeHeight);self.container.css("transform","rotate(0deg)").animate({top:$(window).scrollTop()+$(window).height()/2-e/2,left:$(window).scrollLeft()+$(window).width()/2-t/2,width:t+"px",height:e+"px",padding:l+"px"},function(){self.showInfo();E.showControls()})},setImageSource:function(e){this.image.attr("src",e).css({width:"100%",height:"100%","margin-top":"0"})}};var E={next:$('<div id="photopile-nav-next" />'),prev:$('<div id="photopile-nav-prev" />'),init:function(){w.container.append(this.next);w.container.append(this.prev);$("ul.photopile li:first").addClass("first");$("ul.photopile li:last").addClass("last");this.bindUIActions()},bindUIActions:function(){this.next.click(function(e){e.preventDefault();E.pickupNext()});this.prev.click(function(e){e.preventDefault();E.pickupPrev()});$(document.documentElement).keyup(function(e){if(e.keyCode==39){E.pickupNext()}if(e.keyCode==37){E.pickupPrev()}})},pickupNext:function(){var e=b.getActive();if(!e)return;if(e.hasClass("last")){w.pickup($("ul.photopile").children().first())}else{w.pickup(e.next("li"))}},pickupPrev:function(){var e=b.getActive();if(!e)return;if(e.hasClass("first")){w.pickup($("ul.photopile").children().last())}else{w.pickup(e.prev("li"))}},hideControls:function(){this.next.css("opacity","0");this.prev.css("opacity","0")},showControls:function(){this.next.css("opacity","100");this.prev.css("opacity","100")}};return{scatter:g,autoplay:y}}();photopile.scatter()